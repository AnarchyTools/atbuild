package:
  name: "atbuild"

tasks:
    helloworld:
        tool: "shell"
        script: "echo \"Hello world\""

    default:
        dependency: ["yaml"]
        tool: "atllbuild"
        source: ["cli/src/**.swift"]
        name: "atbuild"
        outputType: "executable"
        linkWithProduct: ["yaml.a"]

    bootstrap-yaml-osx:
        tool: "atllbuild"
        source: ["parsers/yaml/**.swift"]
        name: "yaml"
        llbuildyaml: "yaml-osx-llbuild.yaml"
        outputType: "static-library"
        bootstrapOnly: true

    bootstrap-yaml-linux:
        tool: "atllbuild"
        source: ["parsers/yaml/**.swift"]
        name: "yaml"
        llbuildyaml: "yaml-linux-llbuild.yaml"
        outputType: "static-library"
        linkSDK: false
        compileOptions: ["-D","CORELIBS_FOUNDATION"]
        bootstrapOnly: true

    bootstrap-osx:
        tool: "atllbuild"
        source: ["cli/src/**.swift"]
        name: "atbuild"
        bootstrapOnly: true
        llbuildyaml: "llbuild-osx.yaml"
        outputType: "executable"
        linkWithProduct: ["yaml.a"]
        dependency: ["bootstrap-yaml-osx"]

    bootstrap-linux:
        tool: "atllbuild"
        source: ["cli/src/**.swift"]
        name: "atbuild"
        bootstrapOnly: true
        llbuildyaml: "llbuild-linux.yaml"
        linkSDK: false
        compileOptions: ["-D","CORELIBS_FOUNDATION"]
        outputType: "executable"
        linkWithProduct: ["yaml.a"]
        dependency: ["bootstrap-yaml-linux"]

    bootstrap:
        tool: "nop"
        dependency: ["bootstrap-osx", "bootstrap-linux"]

    yaml:
        tool: "atllbuild"
        source: ["parsers/yaml/**.swift"]
        name: "yaml"
        outputType: "static-library"
        
    atpkg-model:
        dependency: ["atpkg-parser"]
        tool: "atllbuild"
        source: ["model/src/**.swift"]
        name: "atpkgmodel"
        outputType: "static-library"
        linkWithProduct: ["atpkgparser.a"]
        
    atpkg-parser:
        tool: "atllbuild"
        source: ["parsers/atpkg/src/**.swift"]
        name: "atpkgparser"
        outputType: "static-library"
        
    atpkg-tests:
        dependency: ["atpkg-parser", "atpkg-model"]
        tool: "atllbuild"
        source: ["parsers/atpkg/tests/**.swift"]
        name: "atpkgtests"
        outputType: "executable"
        linkWithProduct: ["atpkgparser.a", "atpkgmodel.a"]
        
    run-atpkg-tests:
        dependency: ["atpkg-tests"]
        tool: "shell"
        script: "./.atllbuild/products/atpkgtests"
    
    run-tests:
        tool: "nop"
        dependency: ["run-atpkg-tests"]
